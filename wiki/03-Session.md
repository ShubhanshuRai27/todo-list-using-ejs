# Express-Session

The express-session is the Node.js module which is used to make a session at the server-side.

In order to associate a request to any other request, you need a way to store user data between HTTP requests. Cookies and URL parameters are both suitable ways to transport data between the client and the server. But they are both readable and on the client-side. Sessions solve exactly this problem. You assign the client an ID and it makes all further requests using that ID. Information associated with the client is stored on the server linked to this ID and then instead of the client-side, the session is maintained at the server-side.

We will need the Express-session, so install it using the following code

```js
npm install --save express-session
```

Also, run `npm install` to install all the required packages.


The following code shows how to use express-session in your app :

```js
// importing the express-session in our code and assigning it to session named variable
const session = require("express-session");

//importing express module and calling it
const express = require('express');
const app = express();

// using session object on server-side as middleware and
// the parameters that session takes are explained below
app.use(session({
    secret: "KonfinitySecretKey",
    resave: false,
    saveUninitialized: false,
    cookie : {<options>}
}));
```

Session object takes some parameters as an object, some of them are :

- **secret** : _It is the required parameter_. This is the secret used to sign the session ID cookie. This can be either a string for a single secret or an array of multiple secrets. If an array of secrets is provided, only the first element will be used to sign the session ID cookie, while all the elements will be considered when verifying the signature in requests.

- **resave**: Forces the session to be saved back to the session store, even if the session was never modified during the request. Depending on your store this may be necessary, but it can also create race conditions where a client makes two parallel requests to your server and changes made to the session in one request may get overwritten when the other request ends, even if it made no changes (this behavior also depends on what store you're using).

The default value is _true_, but using the default has been deprecated, as the default will change in the future. Please research into this setting and choose what is appropriate to your use-case. Typically, you'll want _false_.

- **saveUninitialized**: Forces a session that is "uninitialized" to be saved to the store. A session is uninitialized when it is new but not modified. Choosing false is useful for implementing login sessions, reducing server storage usage, or complying with laws that require permission before setting a cookie. Choosing false will also help with race conditions where a client makes multiple parallel requests without a session.

The default value is true, but using the default has been deprecated, as the default will change in the future. Please research into this setting and choose what is appropriate to your use-case.

- **cookie** : Settings object for the session ID cookie. The default value is :

```js
 { path: '/', httpOnly: true, secure: false, maxAge: null }.
```

express-session object gives the `req` object a property called `session`. `req.session` contains the value stored in the session, values are stored as an object for eg: storing `id` with value `1` in session, the code will be like this :

```js
req.session.id = 1;
```

## Example for express-session :

Let us create a web page counter that will count the number of times you visited the page.

```js
// importing express module
var express = require("express");

// importing cookie-parser. it is a middleware that will parse the cookie from which we will fetch session-id generated by the session object
var cookieParser = require("cookie-parser");

// importing express-session object
var session = require("express-session");

// creating object of express
var app = express();

// using cookie parser on our application
app.use(cookieParser());

// using express session object with secret key : "KonfinitySecretKey",
// resave and saveUninitialized options as false
// using default cookie value
app.use(
  session({
    secret: "KonfinitySecretKey",
    resave: false,
    saveUninitialized: false,
    cookie: {}
  })
);

// mapping response generated by callback with `/` url
app.get("/", function(req, res) {
  // req.session.page_views store the count value of page visited
  // checking whether page_views exists or not
  if (req.session.page_views) {
    // if exists then
    req.session.page_views++; // increase number of views
    res.send("You visited this page " + req.session.page_views + " times"); // sending response to the url from server
  } else {
    // if page_views not exists then
    req.session.page_views = 1; // initialize page_views value to 1.
    res.send("Welcome to this page for the first time!"); // sending response to client
  }
});

// listening on port 3000
app.listen(3000);
```

The above code will show the output as shown in the image :

- When you visit the first time :

![](https://s3.ap-south-1.amazonaws.com/appdev.konfinity.com/session_first.jpg)

- when you refresh the page 42 times then the output will be as shown :

![](https://s3.ap-south-1.amazonaws.com/appdev.konfinity.com/session_42.jpg)

To know more about express-sessions and how they work, check out this [video](https://www.youtube.com/watch?v=OH6Z0dJ_Huk&t=1802s)